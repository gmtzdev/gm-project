<div class="subscription-form-container" [class.show]="modalConfig.isVisible">
    <div class="form-overlay" (click)="closeForm()"></div>
    
    <div class="form-modal">
    <div class="form-header">
        <h3>{{ modalConfig.mode === 'edit' ? 'Edit Subscription' : 'Add New Subscription' }}</h3>

        <button class="close-btn" (click)="closeForm()" aria-label="Close">
        <i class="fa-solid fa-xmark"></i>
        </button>
    </div>

    <form [formGroup]="subscriptionForm" (ngSubmit)="onSubmit()" class="subscription-form">
        <!-- Basic Information -->
        <div class="form-section">
        <h4 class="section-title">Basic Information</h4>
        
        <div class="form-row">
            <div class="form-group">
            <label for="name" class="form-label">Service Name *</label>
            <input
                type="text"
                id="name"
                formControlName="name"
                class="form-input"
                [class.invalid]="isFieldInvalid('name')"
                placeholder="e.g., Netflix, Spotify, Adobe">
            @if (isFieldInvalid('name')) {
                <span class="error-message">{{ getErrorMessage('name') }}</span>
            }
            </div>

            <div class="form-group">
            <label for="provider" class="form-label">Provider</label>
            <input
                type="text"
                id="provider"
                formControlName="provider"
                class="form-input"
                placeholder="e.g., Netflix Inc., Spotify AB">
            </div>
        </div>

        <div class="form-group">
            <label for="description" class="form-label">Description</label>
            <textarea
            id="description"
            formControlName="description"
            class="form-textarea"
            rows="3"
            placeholder="Brief description of the service..."></textarea>
        </div>
        </div>

        <!-- Pricing Information -->
        <div class="form-section">
        <h4 class="section-title">Pricing</h4>
        
        <div class="form-row">
            <div class="form-group">
            <label for="price" class="form-label">Price *</label>
            <div class="input-with-currency">
                <select formControlName="currency" class="currency-select">
                <option value="$">USD ($)</option>
                <option value="€">EUR (€)</option>
                <option value="£">GBP (£)</option>
                <option value="¥">JPY (¥)</option>
                </select>
                <input
                type="number"
                id="price"
                formControlName="price"
                class="form-input price-input"
                [class.invalid]="isFieldInvalid('price')"
                placeholder="0.00"
                step="0.01"
                min="0">
            </div>
            @if (isFieldInvalid('price')) {
                <span class="error-message">{{ getErrorMessage('price') }}</span>
            }
            </div>

            <div class="form-group">
            <label for="billingCycle" class="form-label">Billing Cycle *</label>
            <select
                id="billingCycle"
                formControlName="billingCycle"
                class="form-select"
                [class.invalid]="isFieldInvalid('billingCycle')">
                <option value="">Select billing cycle</option>
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
            </select>
            @if (isFieldInvalid('billingCycle')) {
                <span class="error-message">{{ getErrorMessage('billingCycle') }}</span>
            }
            </div>
        </div>
        </div>

        <!-- Dates -->
        <div class="form-section">
        <h4 class="section-title">Dates</h4>
        
        <div class="form-row">
            <div class="form-group">
            <label for="startDate" class="form-label">Start Date *</label>
            <input
                type="date"
                id="startDate"
                formControlName="startDate"
                class="form-input"
                [class.invalid]="isFieldInvalid('startDate')">
            @if (isFieldInvalid('startDate')) {
                <span class="error-message">{{ getErrorMessage('startDate') }}</span>
            }
            </div>

            <div class="form-group">
            <label for="renewalDate" class="form-label">Next Renewal Date *</label>
            <input
                type="date"
                id="renewalDate"
                formControlName="renewalDate"
                class="form-input"
                [class.invalid]="isFieldInvalid('renewalDate')">
            @if (isFieldInvalid('renewalDate')) {
                <span class="error-message">{{ getErrorMessage('renewalDate') }}</span>
            }
            </div>
        </div>
        </div>

        <!-- Category and Settings -->
        <div class="form-section">
        <h4 class="section-title">Category & Settings</h4>
        
        <div class="form-row">
            <div class="form-group">
            <label for="categoryId" class="form-label">Category *</label>

            <select
                id="categoryId"
                formControlName="categoryId"
                class="form-select"
                [class.invalid]="isFieldInvalid('categoryId')">
                <option value="">Select category</option>
                @for (category of categories; track category.id) {
                <option class="category-option" [value]="category.id">{{ category.name }}</option>
                }
            </select>
            @if (isFieldInvalid('categoryId')) {
                <span class="error-message">{{ getErrorMessage('categoryId') }}</span>
            }

            </div>

            <div class="form-group">
            <label for="website" class="form-label">Website</label>
            <input
                type="url"
                id="website"
                formControlName="website"
                class="form-input"
                placeholder="https://example.com">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
            <label for="email" class="form-label">Account Email</label>
            <input
                type="email"
                id="email"
                formControlName="email"
                class="form-input"
                placeholder="account@example.com">
            </div>

            <div class="form-group">
            <label for="color" class="form-label">Theme Color</label>
            <div class="color-input-container">
                <input
                type="color"
                id="color"
                formControlName="color"
                class="color-input">
                <input
                type="text"
                formControlName="color"
                class="form-input color-text"
                placeholder="#000000">
            </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
            <label for="icon" class="form-label">Icon (FontAwesome)</label>
            <input
                type="text"
                id="icon"
                formControlName="icon"
                class="form-input"
                placeholder="fa-netflix, fa-spotify, fa-github">
            <small class="form-hint">Use FontAwesome brand icons (without 'fa-brands' prefix)</small>
            </div>

            <div class="form-group checkbox-group">
            <label class="checkbox-label">
                <input
                type="checkbox"
                formControlName="isActive"
                class="checkbox-input">
                <span class="checkmark"></span>
                Active Subscription
            </label>
            </div>
        </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">

        <button type="button" class="btn btn-red" (click)="closeForm()" [disabled]="isLoading">
            Cancel
        </button>

        <button type="submit" class="btn btn-blue" [disabled]="subscriptionForm.invalid || isLoading">
            @if (isLoading) {
            <i class="fa-solid fa-spinner fa-spin"></i>
            <span>{{ modalConfig.mode === 'edit' ? 'Updating...' : 'Creating...' }}</span>
            } @else {
            <span>{{ modalConfig.mode === 'edit' ? 'Update Subscription' : 'Create Subscription' }}</span>
            }
        </button>
        </div>
    </form>
    </div>
</div>